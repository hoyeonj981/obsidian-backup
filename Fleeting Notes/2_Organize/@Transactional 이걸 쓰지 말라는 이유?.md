created at : 2024-02-25 10:41

#### tags

#

--- 

- 테스트 코드에서 자동 롤백을 위해서 transactional을 사용한다.
- transactional은 프록시 기반 aop 기술을 사용한다.
	- 이 때 프로덕션 코드에 transactional이 없어도 해당 코드를 테스트에서 transactional과 함께 사용할 경우 테스트에서는 정상 통과한다.
	- 하지만 프로덕션 코드에서는 트랜잭션이 적용이 안 되는 경우가 발생함
	- 즉, 테스트 환경과 프로덕션 환경이 서로 다르다.
- 그럼 사용하지 말라?
	- 그렇다면 db를 사용한 테스트 코드는 클린업 과정이 반드시 필요하다.
		- 아예 다른 디비를 사용하면 되는 것 아닌가? -> 해결 방안 중 하나임.
		- 테스트에 넣는 데이터와 프로덕션에 넣는 데이터를 구분해서 굳이 클린업이 없어도 정상 동작하게 한다. -> 해결 방안 중 하나
- 그렇다면 복잡한 관계가 구성될 경우 (fk 등) 클린업 과정이 매우 불편할텐데?
	- 최근 fk를 걸지 않고 애플리케이션에서 관계를 관리한다.
		- online ddl이 어렵기 때문
	- truncate 과정을 빈으로 등록해서 그냥 테스트 코드에서 호출해서 사용하면 편리함
### References
---
[]()
