created at : 2024-06-17 12:09

#### tags

#

--- 

- 왜 영속성 상태를 구별할 필요가 있을까?
	- 추측
		- 클래스는 자신이 관리가 되는 것을 모른다.
			- 어떻게? - bytecode 조작하거나 proxy, weaving 기술이 적용된 것이 아닐까?

- 준 영속성은 왜 필요한가?
	- detached
		- 즉, 영속된 상태(관리)에서 비영속 상태(관리x)가 된 상태.
		- 그냥 비영속(transient)로 바꾸면 될 것 아닌가?
		- 왜 굳이 준영속이란 개념이 필요할까?
	- 책에서는
		- 영속성 컨텍스트는 트랜잭션 단위로 열리고 닫힌다.
		- 열렸을 때 데이터를 로드했다면 닫힌 후에도 로드된 인스턴스에 대한 handle이 여전히 남아 있다.
		- 이 때 해당 handle은 오래된 데이터이며, 참조를 폐기할 수도 나중에 진행된 작업이 다시 merge될 수도 있다.
		- 즉, 처음부터 remove가 된다면 handle마저도 삭제되어 끝난다. 결국 다시 로드하는 과정이 필요해진다.
		- 하지만 detached 상태가 된다면 다시 로드해야 할 과정이 생략될 수 있다.
		- 긴 트랜잭션을 최적화할 수 있다.
			- 여러 과정을 거쳐야 할 트랜잭션일 경우 모든 단계를 하나의 트랜잭션으로 관리하는 것은 비효율적.
			- 그렇다고 트랜잭션할 때마다 로드하는 것도 비효율적
			- 잠깐 필요할 때 불러와서 잠시 detached해 두고 나머지 작업이 다 끝이나면 merge한다.

### References
---
[]()
https://stackoverflow.com/questions/21622841/why-need-detached-entities-in-jpa